{% extends "Base.html" %}
{% block title %}Notifications - HelpDesk{% endblock %}

{% block breadcrumb %}
  <a href="{{ dashboard_url|default:'/' }}">Dashboard</a>
  <span class="bc-sep">/</span>
  <strong>Notifications</strong>
{% endblock %}

{% block content %}
<div class="page-header d-flex align-items-center justify-content-between flex-wrap gap-2">
  <div>
    <div class="page-title">Notifications</div>
    <div class="page-sub">Track ticket updates and system alerts</div>
  </div>
  <div class="d-flex gap-2 flex-wrap">
    {% if stats.unread > 0 %}
    <a href="{% url 'mark_all_read' %}" class="btn btn-sm btn-primary">
      <i class="fas fa-check-double me-1"></i>Mark All as Read
    </a>
    {% endif %}
    {% if stats.total > 0 %}
    <a href="{% url 'delete_all_notifications' %}" class="btn btn-sm btn-outline-danger"
       onclick="return confirm('Delete all notifications?');">
      <i class="fas fa-trash-alt me-1"></i>Delete All
    </a>
    {% endif %}
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-6 col-md-4">
    <div class="stat-card">
      <div class="stat-icon si-blue"><i class="fas fa-bell"></i></div>
      <div>
        <div class="stat-label">Total</div>
        <div class="stat-value">{{ stats.total|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-4">
    <div class="stat-card">
      <div class="stat-icon si-yellow"><i class="fas fa-bell-slash"></i></div>
      <div>
        <div class="stat-label">Unread</div>
        <div class="stat-value">{{ stats.unread|default:0 }}</div>
      </div>
    </div>
  </div>
  <div class="col-6 col-md-4">
    <div class="stat-card">
      <div class="stat-icon si-green"><i class="fas fa-check-circle"></i></div>
      <div>
        <div class="stat-label">Read</div>
        <div class="stat-value">{{ stats.read|default:0 }}</div>
      </div>
    </div>
  </div>
</div>

<div class="mb-3 d-flex gap-2 flex-wrap">
  <a href="{% url 'notifications_list' %}?filter=all"
     class="btn btn-sm {% if filter_type == 'all' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
    All
  </a>
  <a href="{% url 'notifications_list' %}?filter=unread"
     class="btn btn-sm {% if filter_type == 'unread' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
    Unread
  </a>
  <a href="{% url 'notifications_list' %}?filter=read"
     class="btn btn-sm {% if filter_type == 'read' %}btn-primary{% else %}btn-outline-secondary{% endif %}">
    Read
  </a>
</div>

<div class="hd-card">
  {% if notifications %}
  <div class="table-responsive">
    <table class="hd-table">
      <thead>
        <tr>
          <th>Message</th>
          <th>Type</th>
          <th>Time</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for notif in notifications %}
        <tr>
          <td>
            <div style="font-weight:600;color:var(--slate-800);">{{ notif.message }}</div>
          </td>
          <td>{{ notif.get_notification_type_display }}</td>
          <td>{{ notif.created_at|timesince }} ago</td>
          <td>
            {% if notif.is_read %}
            <span class="status-badge sb-closed">Read</span>
            {% else %}
            <span class="status-badge sb-open">Unread</span>
            {% endif %}
          </td>
          <td>
            <div class="d-flex gap-2">
              {% if not notif.is_read %}
              <a href="{% url 'mark_notification_read' notif.id %}" class="btn btn-sm btn-outline-primary">
                Mark Read
              </a>
              {% endif %}
              <a href="{% url 'delete_notification' notif.id %}" class="btn btn-sm btn-outline-danger"
                 onclick="return confirm('Delete this notification?');">
                Delete
              </a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if notifications.has_other_pages %}
  <div class="hd-card-footer d-flex justify-content-between align-items-center">
    <span style="font-size:12px;color:var(--slate-500);">
      Page {{ notifications.number }} of {{ notifications.paginator.num_pages }}
    </span>
    <div class="d-flex gap-2">
      {% if notifications.has_previous %}
      <a href="?filter={{ filter_type }}&page={{ notifications.previous_page_number }}" class="btn btn-sm btn-outline-secondary">Prev</a>
      {% endif %}
      {% if notifications.has_next %}
      <a href="?filter={{ filter_type }}&page={{ notifications.next_page_number }}" class="btn btn-sm btn-outline-secondary">Next</a>
      {% endif %}
    </div>
  </div>
  {% endif %}
  {% else %}
  <div class="empty-state">
    <div class="empty-icon"><i class="fas fa-bell-slash"></i></div>
    <div class="empty-title">No notifications</div>
    <div class="empty-text">You are all caught up.</div>
  </div>
  {% endif %}
</div>
{% endblock %}
