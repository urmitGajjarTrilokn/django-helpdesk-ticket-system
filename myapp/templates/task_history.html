{% extends "Base.html" %}
{% block title %}Task History - HelpDesk{% endblock %}

{% block breadcrumb %}
  <strong>Task History</strong>
{% endblock %}

{% block content %}
{% if resolved_history_mode %}
<div class="hd-card">
  <div class="hd-card-header">
    <div class="hd-card-title"><i class="fas fa-history" style="color:var(--brand);"></i> Resolved/Closed History</div>
  </div>
  <div class="table-responsive">
    <table class="hd-table">
      <thead>
        <tr><th>#</th><th>Title</th><th>Status</th><th>Resolved By</th><th>Resolved On</th></tr>
      </thead>
      <tbody>
        {% for t in resolved_tasks %}
        <tr>
          <td>#{{ t.id }}</td>
          <td><a href="{% url 'taskinfo' t.id %}">{{ t.TASK_TITLE|truncatechars:60 }}</a></td>
          <td>{{ t.TASK_STATUS }}</td>
          <td>{{ t.resolved_by|default:"-" }}</td>
          <td>{{ t.resolved_on|date:"M d, Y H:i"|default:"-" }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center text-muted py-4">No history found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="hd-card">
  <div class="hd-card-header">
    <div class="hd-card-title"><i class="fas fa-stream" style="color:var(--brand);"></i> #{{ task.id }} {{ task.TASK_TITLE|truncatechars:60 }}</div>
  </div>
  <div class="hd-card-body">
    <div class="timeline">
      {% for h in history %}
      <div class="d-flex gap-2 mb-3">
        <div class="stat-icon si-indigo" style="width:32px;height:32px;font-size:12px;"><i class="fas fa-circle"></i></div>
        <div>
          <div style="font-weight:700;color:var(--slate-800);">{{ h.get_action_type_display }}</div>
          <div style="font-size:13px;color:var(--slate-600);">{{ h.description|default:"-" }}</div>
          <div style="font-size:12px;color:var(--slate-400);">{{ h.changed_at|date:"M d, Y H:i" }}{% if h.changed_by %} by {{ h.changed_by.username }}{% endif %}</div>
        </div>
      </div>
      {% empty %}
      <div class="text-muted">No changes recorded.</div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
